<%- include("../layouts/adminheader.ejs") %>
<%- include("../layouts/bars.ejs") %>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">

<main class="main-wrap">
    <header class="main-header navbar">
       
        <div class="col-nav">
            <button class="btn btn-icon btn-mobile me-auto" data-trigger="#offcanvas_aside"> <i class="material-icons md-apps"></i> </button>
            <ul class="nav">
              
                
                    <div class="dropdown-menu " aria-labelledby="dropdownAccount">
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item text-muted" href="/admin/logout"><i class="material-icons md-exit_to_app"></i>Logout</a>
                        
                    </div>            

                    <a class="dropdown-toggle" data-bs-toggle="dropdown" href="#" id="dropdownAccount" aria-expanded="false"> <img class="img-xs rounded-circle" src="data:image/jpeg;base64,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" alt="User"></a>
                   
                    
            </ul>
        </div>
    </header>
<section class="content-main">
    <div class="content-header">
        <div>
            <h2 class="content-title card-title">Sales Report</h2>
            <p></p>
        </div>
        <div>
            <input type="text" placeholder="Search order ID" class="form-control bg-white">
        </div>
    </div>
    <div class="card mb-4">

        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover">
                    <% if(sales.length != 0) { %>
                    <input type="date" name="startdate" id="startdate" onchange="cli()">
                    <input type="date" name="enddate" id="enddate" onchange="cli()">
                    <span type="button" id="pdf" class="border-0 bg-transparent material-icons">file_download</span>
                    <span type="button" id="excel" class="border-0 bg-transparent material-icons">picture_as_pdf</span>
                    <table class="table text-center border " id="ordersTable">
                        <% } %>
                    <thead>
                        <tr>
                            <th scope="col">SL NO</th>
                            <th scope="col">Order Id</th>
                            <th scope="col">Product </th>
                            <th scope="col">Payment Method</th>
                            <th scope="col">Price</th>
                            <th scope="col">Status</th>
                            <th scope="col">Date</th>
                           
                        </tr>
                    </thead>
                    <tbody id="tbody">
                        <% if(sales.length> 0){ %>
                            <% for(let i=1;i<=sales.length; i++){ %>  
                                <% j=0 %>
                        <tr style="height:7rem">
                            <td><%= i %></td>
                            <td>
                                <%= sales[i-1]._id  %> 
                            </td>
                            <td>
                                <%= product[j].name %>
                            </td>
                            <td>
                                <%= sales[i-1].payment.method%> 
                            </td>
                            <td>
                                <%= sales[i-1].payment.amount%> 
                                
                            </td>
                            <td>  
                                <%= sales[i-1].status%> 
                            </td>
                            <td>
                                <%= sales[i-1].createdAt.toISOString().slice(0,10) %>
                            </td>
                            <% j++ %>
                        </form>

                        </tr>
                        <% } } else{ %>
                            <tr>
                                <td colspan="5">No Orders</td>
                            </tr>
                            <% } %>

                    </tbody>
                </table>
            </div> <!-- table-responsive //end -->
        </div> <!-- card-body end// -->
    </div> <!-- card end// -->
    <!-- <div class="pagination-area mt-15 mb-50">
        <nav aria-label="Page navigation example">
            <ul class="pagination justify-content-start">
                <li class="page-item active"><a class="page-link" href="#">01</a></li>
                <li class="page-item"><a class="page-link" href="#">02</a></li>
                <li class="page-item"><a class="page-link" href="#">03</a></li>
                <li class="page-item"><a class="page-link dot" href="#">...</a></li>
                <li class="page-item"><a class="page-link" href="#">16</a></li>
                <li class="page-item"><a class="page-link" href="#"><i class="material-icons md-chevron_right"></i></a></li>
            </ul>
        </nav>
    </div> -->
</section> <!-- content-main end// -->




<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>


</main>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script>
<script
    src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.6/jspdf.plugin.autotable.min.js"></script>

<!-- SheetJS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.3/xlsx.full.min.js"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    // Download as PDF
    // console.log(jsPDF);
    document.getElementById('pdf').addEventListener('click', function () {
        var doc = new jsPDF();
        var ordersTable = document.getElementById('ordersTable');
        var orders = [];

        for (var i = 1; i < ordersTable.rows.length; i++) {
    var order = {
      orderId: ordersTable.rows[i].cells[0].innerHTML,
      product: ordersTable.rows[i].cells[1].innerHTML,
      price: ordersTable.rows[i].cells[4].innerHTML,
      method: ordersTable.rows[i].cells[5].innerHTML,
    };
    orders.push(order);
  }

        doc.autoTable({
            html: '#ordersTable',
            columns: [
                { header: 'Order ID', dataKey: 'Order ID' },
                { header: 'Product', dataKey: 'Product' },
                { header: 'Price', dataKey: 'Price' },
                { header: 'Method', dataKey: 'Method' },
                { header: 'Method', dataKey: 'Method' },
                { header: 'Method', dataKey: 'Method' },
                { header: 'Method', dataKey: 'Method' },


            ]
        });
        var totalOrders = orders.length;
  var totalRevenue = orders.reduce((acc, cur) => acc + parseInt(cur.price), 0).toFixed(2);
  console.log(totalRevenue)

  doc.text('Order Summary:', 10, doc.autoTable.previous.finalY + 10);
  doc.text('Total number of orders: ' + totalOrders, 10, doc.autoTable.previous.finalY + 20);
  doc.text('Total revenue: Rs ' + totalRevenue, 10, doc.autoTable.previous.finalY + 30);

  doc.save('sales.pdf');
    });


    function cli() {
    start = document.getElementById("startdate").value;
    end = document.getElementById("enddate").value;
    console.log(start, end);
    data = { start: start, end: end };
    axios.post('/admin/updateorder', data)
        .then(res => {
            if (res.data) {
                console.log(res.data);
                console.log(res.data.orderDetail);
                let orders = res.data.orderDetail;
                let ordersTableHTML = '';
                let totalOrders = 0;
                let totalRevenue = 0;

                if (orders.length > 0) {
                    orders.forEach((order, i) => {
                        ordersTableHTML += `<tr> <th>${i + 1}</th> <td>${order._id}</td> <td>${order.userId.name}</td> <td>${order.payment.method}</td> <td>${order.payment.amount}</td> <td>${order.status}</td> <td>${new Date(order.createdAt).toLocaleDateString()}</td> <td> <a class="text-white btn btn-light" href="/admin/vieworderdetails?id=${order._id}">view Details</a><br> <br> <form action="/admin/updatestatus" method="post"> <select name="status" class="browser-default custom-select"> <option>${order.status}</option> <option>Delivered</option> <option>Shipped</option> <option>packed</option> </select> <input type="hidden" name="orderId" value="${order._id}"> ${order.status !== 'returned' ? '<button style="background-color: darkcyan;" type="submit">update</button>' : ''} </form> </td> </tr> `;
                        totalOrders += 1;
                        totalRevenue += order.payment.amount;
                    });
                } else {
                    ordersTableHTML = '<tr><td colspan="5">Products Not Found</td></tr>';
                }
                let avgOrderValue = totalRevenue / totalOrders;
                let orderSummaryHTML = `
                    <p>Total Orders: ${totalOrders}</p>
                    <p>Total Revenue: ${totalRevenue}</p>
                    <p>Average Order Value: ${avgOrderValue}</p>
                `;
                document.getElementById("order-summary").innerHTML = orderSummaryHTML;
                document.getElementById("tbody").innerHTML = ordersTableHTML;
            }
        })
        .catch(error => {
            console.log(error);
        })
}
</script>


<!-- Include the xlsx library -->
<script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>

<!-- Add the following script after the HTML code -->
<script>
     const pdfButton = document.getElementById("excel");
  pdfButton.addEventListener("click", downloadSalesReport);
  function downloadSalesReport() {
    const salesData = [];
    const table = document.getElementById("ordersTable");
    const rows = table.getElementsByTagName("tr");
     // Get the hea
     const headerRow = rows[0];
    const headerCells = headerRow.getElementsByTagName("th");
    const headerData = [];

    // Iterate over each header cell and push the text content to the headerData array
    for (let i = 0; i < headerCells.length; i++) {
      const headerCell = headerCells[i];
      headerData.push(headerCell.innerText);
    }

    // Add the header data to the salesData array
    salesData.push(headerData);
    
    // Iterate over each row of the table (skipping the header row)
    for (let i = 1; i < rows.length; i++) {
      const row = rows[i];
      const rowData = [];
      
      // Iterate over each cell in the row
      const cells = row.getElementsByTagName("td");
      for (let j = 0; j < cells.length; j++) {
        const cell = cells[j];
        rowData.push(cell.innerText);
      }
      
      // Add the row data to the salesData array
      salesData.push(rowData);
    }
    
    // Create a new workbook
    const workbook = XLSX.utils.book_new();

    // Convert the salesData array to a worksheet
    const worksheet = XLSX.utils.aoa_to_sheet(salesData);

    // Add the worksheet to the workbook
    XLSX.utils.book_append_sheet(workbook, worksheet, "Sales Report");

    // Generate the Excel file
    const excelBuffer = XLSX.write(workbook, { bookType: "xlsx", type: "array" });

    // Convert the Excel buffer to a blob
    const blob = new Blob([excelBuffer], { type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" });

    // Create a download link and trigger the download
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "sales_report.xlsx";
    link.click();
  }
  
  // Attach the downloadSalesReport function to the PDF button's click event
 
</script>






   
<%- include("../layouts/adminfooter.ejs") %>